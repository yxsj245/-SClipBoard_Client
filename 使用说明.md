# 共享剪切板同步工具 - 使用说明

## 快速开始

### 1. 安装和启动

#### 方法一：自动安装（推荐）
1. 双击运行 `install.py` 进行自动安装
2. 安装完成后双击 `启动.bat` 启动程序

#### 方法二：手动安装
1. 确保已安装 Python 3.7+
2. 运行命令：`pip install -r requirements.txt`
3. 运行命令：`python main.py`

### 2. 配置服务器

首次使用需要配置服务器信息：

1. 启动程序后，点击"设置"按钮
2. 在"服务器配置"中输入：
   - **服务器IP地址**：例如 `192.168.1.100`
   - **API端口**：默认 `3001`
   - **WebSocket端口**：默认 `3002`

3. 如果服务器启用了安全认证，在"安全配置"中输入：
   - **认证头名称**：例如 `X-API-Key`
   - **认证头值**：您的API密钥

4. 点击"保存设置"

### 3. 开始同步

#### 单向同步（本地→服务器）
- 点击"开始单向同步"按钮
- 程序将监听本地剪切板变化
- 当复制新内容时，自动上传到服务器

#### 双向同步（本地↔服务器）
- 点击"开始双向同步"按钮
- 程序建立WebSocket连接
- 实现本地和服务器剪切板内容双向同步

## 功能详解

### 系统托盘

程序支持最小化到系统托盘运行：

- **双击托盘图标**：显示/隐藏主窗口
- **右键托盘图标**：显示快捷菜单
  - 显示主窗口
  - 开始/停止单向同步
  - 开始/停止双向同步
  - 退出程序

### 状态监控

在"状态"标签页可以查看：

- **服务器状态**：API服务器连接状态
- **WebSocket状态**：WebSocket连接状态
- **监听状态**：剪切板监听状态
- **同步状态**：双向同步状态
- **统计信息**：剪切板项目数量和最后同步时间

### 日志查看

在"日志"标签页可以查看：

- 详细的操作记录
- 错误信息和警告
- 同步活动记录
- 连接状态变化

### 设置选项

#### 服务器配置
- **服务器IP地址**：剪切板同步服务器的IP地址
- **API端口**：HTTP API服务端口
- **WebSocket端口**：WebSocket服务端口

#### 安全配置
- **认证头名称**：安全认证的请求头名称
- **认证头值**：对应的认证值

#### 其他设置
- **开机自启动**：系统启动时自动运行程序
- **启动时最小化到托盘**：程序启动后直接最小化
- **启用通知**：显示系统托盘通知
- **剪切板检查间隔**：检查剪切板变化的时间间隔

## 常见问题

### Q: 无法连接到服务器
**A:** 请检查：
1. 服务器IP地址和端口是否正确
2. 服务器是否正在运行
3. 网络连接是否正常
4. 防火墙是否阻止了连接

### Q: WebSocket连接失败
**A:** 请检查：
1. WebSocket端口配置是否正确
2. 服务器WebSocket服务是否启动
3. 安全配置是否正确
4. 查看日志获取详细错误信息

### Q: 剪切板监听不工作
**A:** 请检查：
1. 程序是否有访问剪切板的权限
2. 剪切板检查间隔设置是否合理
3. 查看日志获取错误信息

### Q: 同步内容过长被跳过
**A:** 程序限制单次同步内容不超过10000字符，超长内容会被跳过并记录日志。

## 技术说明

### 安全配置格式

WebSocket连接会自动附加安全参数：
```
ws://服务器IP:端口/ws?deviceId=设备ID&authKey=认证头名称&authValue=认证头值
```

### 支持的消息类型

程序支持以下WebSocket消息类型：
- `sync_content` / `content_update`：同步剪切板内容
- `ping` / `heartbeat`：心跳消息
- `device_connected`：设备连接通知
- `device_disconnected`：设备断开通知
- `error`：错误消息

### 配置文件位置

程序使用QSettings保存配置，Windows下位置：
```
HKEY_CURRENT_USER\Software\ClipboardSync\Settings
```

## 故障排除

1. **查看日志**：在"日志"标签页查看详细错误信息
2. **重启程序**：关闭程序后重新启动
3. **检查配置**：确认服务器配置正确
4. **测试连接**：使用浏览器访问 `http://服务器IP:端口/health` 测试API连接

## 联系支持

如果遇到问题，请：
1. 查看日志获取错误信息
2. 检查服务器状态
3. 参考开发文档中的API说明
